# SPDX-FileCopyrightText: 2025 United Security Providers AG, Switzerland
#
# SPDX-License-Identifier: GPL-3.0-only

apiVersion: waap.core.u-s-p.ch/v1alpha1
kind: CoreWaapService
metadata:
  name: juiceshop-usp-core-waap
  namespace: juiceshop
spec:
  websocket: true
  coraza:
    crs:
      requestRuleExceptions:
      - location: "/socket.io/"
        ruleIds:
          - 920420
        requestPartType: "REQUEST_HEADERS"
        requestPartName: "content-type"
        metadata:
          comment: "Request content type is not allowed by default policy"
          date: "2025-10-20"
          createdBy: "autolearning"
  routes:
    - match:
        path: /
        pathType: PREFIX
      backend:
        address: juiceshop
        port: 8080
        protocol:
          selection: h1
